<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 1 Construire un package R | Formation R avancée</title>
  <meta name="description" content="Outils de développement et de performance" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 1 Construire un package R | Formation R avancée" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Outils de développement et de performance" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 1 Construire un package R | Formation R avancée" />
  
  <meta name="twitter:description" content="Outils de développement et de performance" />
  

<meta name="author" content="Robin Genuer et Boris Hejblum" />


<meta name="date" content="2022-06-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Formation R avancée : Outils de développement et de performance </a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Présentation de la formation</a></li>
<li class="chapter" data-level="1" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html"><i class="fa fa-check"></i><b>1</b> Construire un package <code>R</code></a>
<ul>
<li class="chapter" data-level="1.1" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#initialiser-un-package"><i class="fa fa-check"></i><b>1.1</b> Initialiser un package</a></li>
<li class="chapter" data-level="1.2" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#ajouter-une-fonction-exemple-fil-rouge"><i class="fa fa-check"></i><b>1.2</b> Ajouter une fonction : exemple fil rouge</a></li>
<li class="chapter" data-level="1.3" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#documenter-une-fonction"><i class="fa fa-check"></i><b>1.3</b> Documenter une fonction</a></li>
<li class="chapter" data-level="1.4" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#tester-le-package-de-manière-intéractive"><i class="fa fa-check"></i><b>1.4</b> Tester le package de manière <em>intéractive</em></a></li>
<li class="chapter" data-level="1.5" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#tester-le-package-de-manière-automatique"><i class="fa fa-check"></i><b>1.5</b> Tester le package de manière <em>automatique</em></a></li>
<li class="chapter" data-level="1.6" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#faire-un-check-du-package"><i class="fa fa-check"></i><b>1.6</b> Faire un <em>check</em> du package</a></li>
<li class="chapter" data-level="1.7" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#installer-le-package"><i class="fa fa-check"></i><b>1.7</b> Installer le package</a></li>
<li class="chapter" data-level="1.8" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#annexe-1.1-ajouter-une-méthode-s3"><i class="fa fa-check"></i><b>1.8</b> Annexe 1.1 : ajouter une méthode S3</a></li>
<li class="chapter" data-level="1.9" data-path="construire-un-package-r.html"><a href="construire-un-package-r.html#annexe-1.2-soumettre-son-package-au-cran"><i class="fa fa-check"></i><b>1.9</b> Annexe 1.2 : soumettre son package au CRAN</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><i class="fa fa-check"></i><b>2</b> Contrôle de version avec <code>git</code> et GitHub : historique de changement, développement collaboratif et intégration continue</a>
<ul>
<li class="chapter" data-level="2.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#principe-du-contrôle-de-version"><i class="fa fa-check"></i><b>2.1</b> Principe du contrôle de version</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#git"><i class="fa fa-check"></i><b>2.1.1</b> <code>git</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#subversion"><i class="fa fa-check"></i><b>2.1.2</b> <code>subversion</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#utiliser-git-localement-depuis-rstudio"><i class="fa fa-check"></i><b>2.2</b> Utiliser <code>git</code> localement depuis RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#bonnes-pratiques-du-commit"><i class="fa fa-check"></i><b>2.2.1</b> Bonnes pratiques du <em>commit</em></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#github"><i class="fa fa-check"></i><b>2.3</b> GitHub</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#mettre-son-package-r-sur-github"><i class="fa fa-check"></i><b>2.3.1</b> Mettre son package <code>R</code> sur GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#collaboration-pour-la-production-du-code"><i class="fa fa-check"></i><b>2.4</b> Collaboration pour la production du code</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#branches"><i class="fa fa-check"></i><b>2.4.1</b> <em>Branches</em></a></li>
<li class="chapter" data-level="2.4.2" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#merge"><i class="fa fa-check"></i><b>2.4.2</b> <em>Merge</em></a></li>
<li class="chapter" data-level="2.4.3" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#les-conflits"><i class="fa fa-check"></i><b>2.4.3</b> Les conflits</a></li>
<li class="chapter" data-level="2.4.4" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#fork"><i class="fa fa-check"></i><b>2.4.4</b> <em>Fork</em></a></li>
<li class="chapter" data-level="2.4.5" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#pull-request"><i class="fa fa-check"></i><b>2.4.5</b> <em>Pull request</em></a></li>
<li class="chapter" data-level="2.4.6" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#issues"><i class="fa fa-check"></i><b>2.4.6</b> <em>Issues</em></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#intégration-continue"><i class="fa fa-check"></i><b>2.5</b> Intégration continue</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#github-actions"><i class="fa fa-check"></i><b>2.5.1</b> <em>GitHub Actions</em></a></li>
<li class="chapter" data-level="2.5.2" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#r-hub"><i class="fa fa-check"></i><b>2.5.2</b> R-hub</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html"><a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html#annexe-2.1-couverture-du-code"><i class="fa fa-check"></i><b>2.6</b> Annexe 2.1 : couverture du code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mesurer-et-comparer-des-temps-dexécution.html"><a href="mesurer-et-comparer-des-temps-dexécution.html"><i class="fa fa-check"></i><b>3</b> Mesurer et comparer des temps d’exécution</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mesurer-et-comparer-des-temps-dexécution.html"><a href="mesurer-et-comparer-des-temps-dexécution.html#mesurer-des-temps-dexécution-avec-system.time"><i class="fa fa-check"></i><b>3.1</b> Mesurer des temps d’exécution avec <code>system.time()</code></a></li>
<li class="chapter" data-level="3.2" data-path="mesurer-et-comparer-des-temps-dexécution.html"><a href="mesurer-et-comparer-des-temps-dexécution.html#comparer-des-temps-dexécution-avec-microbenchmark"><i class="fa fa-check"></i><b>3.2</b> Comparer des temps d’exécution avec <code>microbenchmark()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="profiler-son-code.html"><a href="profiler-son-code.html"><i class="fa fa-check"></i><b>4</b> <em>Profiler</em> son code</a>
<ul>
<li class="chapter" data-level="4.1" data-path="profiler-son-code.html"><a href="profiler-son-code.html#comparaison-avec-une-version-plus-habile-de-mnvpdf"><i class="fa fa-check"></i><b>4.1</b> Comparaison avec une version plus habile de <code>mnvpdf()</code></a></li>
<li class="chapter" data-level="4.2" data-path="profiler-son-code.html"><a href="profiler-son-code.html#comparaison-avec-une-version-optimisée-dans-r"><i class="fa fa-check"></i><b>4.2</b> Comparaison avec une version optimisée dans R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html"><a href="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html"><i class="fa fa-check"></i><b>5</b> <code>Rcpp</code> ou comment intégrer facilement du code <code>C++</code>dans un package <code>R</code></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html"><a href="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html#première-fonction-en-rcpp"><i class="fa fa-check"></i><b>5.1</b> Première fonction en Rcpp</a></li>
<li class="chapter" data-level="5.2" data-path="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html"><a href="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html#optimisation-grâce-à-c"><i class="fa fa-check"></i><b>5.2</b> Optimisation grâce à <code>C++</code></a></li>
<li class="chapter" data-level="5.3" data-path="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html"><a href="rcpp-ou-comment-intégrer-facilement-du-code-cdans-un-package-r.html#annexe-5.1-loptimisation-prématurée-nest-pas-une-bonne-idée"><i class="fa fa-check"></i><b>5.3</b> Annexe 5.1 : l’optimisation prématurée n’est pas une bonne idée</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html"><i class="fa fa-check"></i><b>6</b> Parallélisation du code <code>R</code></a>
<ul>
<li class="chapter" data-level="6.1" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#introduction-à-lexecution-parallèle-sous-r"><i class="fa fa-check"></i><b>6.1</b> Introduction à l’execution parallèle sous <code>R</code></a></li>
<li class="chapter" data-level="6.2" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#première-fonction-parallèle-en-r"><i class="fa fa-check"></i><b>6.2</b> Première fonction parallèle en <code>R</code></a></li>
<li class="chapter" data-level="6.3" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#parallélisation-efficace"><i class="fa fa-check"></i><b>6.3</b> Parallélisation efficace</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#les-itérateurs"><i class="fa fa-check"></i><b>6.3.1</b> Les itérateurs</a></li>
<li class="chapter" data-level="6.3.2" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#les-autres-plans-de-calculs-parallèle"><i class="fa fa-check"></i><b>6.3.2</b> Les autres “plans” de calculs parallèle</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#parallélisation-dans-notre-exemple-fil-rouge"><i class="fa fa-check"></i><b>6.4</b> Parallélisation dans notre exemple fil rouge</a></li>
<li class="chapter" data-level="6.5" data-path="parallélisation-du-code-r.html"><a href="parallélisation-du-code-r.html#conclusion"><i class="fa fa-check"></i><b>6.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="take-home-message.html"><a href="take-home-message.html"><i class="fa fa-check"></i><b>7</b> <em>Take Home message</em></a></li>
<li class="chapter" data-level="" data-path="références.html"><a href="références.html"><i class="fa fa-check"></i>Références</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Formation R avancée</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="construire-un-package-r" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapitre 1</span> Construire un package <code>R</code><a href="construire-un-package-r.html#construire-un-package-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Nous présentons ici comment construire un package efficacement à l’aide d’outils
graphiques présents dans Rstudio et du package <code>devtools</code>.</p>
<p>Le support de référence sur ce sujet est le livre
<a href="https://r-pkgs.org/">R packages</a> d’Hadley Wickham.</p>
<div id="initialiser-un-package" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Initialiser un package<a href="construire-un-package-r.html#initialiser-un-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Une manière simple, et intégrée à Rstudio, pour <strong>initialiser un package</strong> est :</p>
<ol style="list-style-type: decimal">
<li><p>de créer un nouveau projet (menu déroulant en haut à droite dans Rstudio)</p></li>
<li><p>choisir “New Directory”</p></li>
<li><p>choisir “R package using devtools” (s’il n’est pas disponible, choisir “R
package”, différence étant qu’avec “R package”, il faudra supprimé des
fichiers créés automatiquement mais non utiles)</p></li>
<li><p>donner un nom au package, par exemple <code>mypkgr</code></p></li>
</ol>
<p>On récupère la structure <strong>minimale pour un package R</strong>, à savoir :</p>
<ul>
<li><p>un fichier <code>DESCRIPTION</code> dont les parties <code>Title</code>, <code>Version</code>, <code>Authors@R</code> et
<code>Description</code> sont à éditer (d’autres parties pourront être éditer voire
même ajouter de manière automatique, voir plus loin)</p></li>
<li><p>un fichier <code>NAMESPACE</code> qui sera éditer automatiquement plus loin</p></li>
<li><p>un dossier <code>R</code> dans lequel on va ajouter des fichiers de scripts R</p></li>
</ul>
<p>Rstudio ajoute également trois <strong>fichiers facultatifs</strong> :</p>
<ul>
<li><p><code>.gitignore</code>, relatif à <code>git</code>, outils de contrôle de version que nous verrons en détails
dans la partie sur GitHub</p></li>
<li><p><code>mypkgr.Rproj</code> qui est un fichier spécifique de Rstudio, et permet de définir
les caractéristiques et préférences du projet que nous venons de créer</p></li>
<li><p><code>.Rbuildignore</code> qui permet d’ignorer certains fichiers au moment où on
construira le package un peu plus loin (par exemple, le fichier <code>mypkgr.Rproj</code>
ne doit pas être inclus dans le package)</p></li>
</ul>
</div>
<div id="ajouter-une-fonction-exemple-fil-rouge" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Ajouter une fonction : exemple fil rouge<a href="construire-un-package-r.html#ajouter-une-fonction-exemple-fil-rouge" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nous vous proposons de coder la fonction suivante, que nous reprendrons tout au
long de la formation :</p>
<p>Nous souhaitons calculer la valeur de la densité d’une loi normale multivariée
sur <span class="math inline">\(\mathbb{R}^p\)</span> en <span class="math inline">\(n\)</span> points. Notre fonction doit pouvoir s’appliquer pour
n’importe quelle loi normale multivariée (vecteur de moyennes dans
<span class="math inline">\(\mathbb{R}^p\)</span> et matrice de variance-covariance d’ordre de <span class="math inline">\(p\)</span> quelconques),
et on souhaite pouvoir calculer toutes les valeurs de la densité évaluées
sur les <span class="math inline">\(n\)</span> points en un seul appel de la fonction.</p>
<p>Vous devez donc créer une fonction <code>mvnpdf()</code> dans un fichier nommé <code>mvnpdf.R</code>
dans le dossier <code>R</code> du package, qui :</p>
<ul>
<li><p>prend en arguments :</p>
<ul>
<li><p><code>x</code> une matrice, à <span class="math inline">\(n\)</span> colonnes (les observations) et <span class="math inline">\(p\)</span> lignes</p></li>
<li><p><code>mean</code> un vecteur de moyennes</p></li>
<li><p><code>varcovM</code> une matrice de variance-covariance</p></li>
<li><p><code>Log</code> un paramètre logique valant <code>TRUE</code> par défaut</p></li>
</ul></li>
<li><p>renvoie une liste contenant la matrice <code>x</code> ainsi qu’un vecteur des images
des points de <code>x</code> par la fonction de densité de la variable aléatoire de loi
normale multivariée considérée.</p></li>
</ul>
<blockquote>
<p><strong><em>A vous de jouer !</em></strong></p>
</blockquote>
<p><strong>ATTENTION ! Si vous cliquez trop vite sur le lien ci-dessous, cela
invalidera votre participation à la formation !</strong></p>
<p>Voici une proposition de fonction que vous pouvez télécharger
<a href="https://r-dev-perf.borishejblum.science/FormationRavancee_dev_perf_files/mvnpdfRAW.R">ici</a>.</p>
<p>Pour des conseils lors de la rédaction de code, voir la page
<a href="https://r-pkgs.org/r.html">R code</a> du site d’Hadley.</p>
</div>
<div id="documenter-une-fonction" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Documenter une fonction<a href="construire-un-package-r.html#documenter-une-fonction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Il est important de bien documenter votre code. Tout projet a au moins 2
développeurs :</p>
<ul>
<li><p>vous</p></li>
<li><p>vous dans 6 mois</p></li>
</ul>
<p>Par égard à votre futur-vous, soyez sympas et prenez le temps de documenter
votre code !</p>
<p>Nous vous conseillons vivement d’utiliser le package <code>roxygen2</code> pour documenter
vos packages. L’avantage principal étant d’avoir l’aide d’une fonction dans
le même fichier que le code définissant cette fonction.</p>
<blockquote>
<p><strong><em>A vous de jouer !</em></strong></p>
<ol style="list-style-type: decimal">
<li><p>Commencer par insérer le squelette de l’aide grâce à “Insert Roxygen
Skeleton” situé dans le menu “Code” ou le sous-menu <em>Baguette magique</em> dans
la fenêtre de script.</p></li>
<li><p>Compléter la documentation en renseignant :</p></li>
</ol>
<ul>
<li><p>le titre de la fonction (première ligne)</p></li>
<li><p>la description de ce que fait la fonction (deuxième paragraphe)</p></li>
<li><p>si vous renseignez un troisième paragraphe, cette partie ira dans
la section “Details” de la page d’aide</p></li>
<li><p>la signification des paramètres</p></li>
<li><p>la sortie, après la balise <code>@return</code></p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Générer la documentation à l’aide de “Document” dans le menu “More” de
l’onglet “Build” (ou Ctrl+Shift+D ou <code>devtools::document()</code>). L’effet de
cette commande est multiple :</li>
</ol>
<ul>
<li><p>un dossier <code>man</code> a été créé et à l’intérieur, un fichier <code>mvnpdf.Rd</code>
a été créé et contient les informations de l’aide de la fonction</p></li>
<li><p>le fichier <code>NAMESPACE</code> a été modifié</p></li>
</ul>
</blockquote>
<p><strong>En cas de bug ou par curiosité ET une fois que vous avez terminé</strong> vous
pouvez consulter cette
<a href="https://r-dev-perf.borishejblum.science/FormationRavancee_dev_perf_files/mvnpdfRox.R">proposition</a>.</p>
<p>Pour plus de détails sur la documentation de package et les balises
<code>roxygen2</code>, voir la page
<a href="https://r-pkgs.org/man.html">Object documentation</a> du site d’Hadley.</p>
<p>Finissons par évoquer une fonction du package <code>usethis</code> qui initialise une
page d’aide pour le package dans son ensemble :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="construire-un-package-r.html#cb1-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package_doc</span>()</span></code></pre></div>
<p>La page d’aide générée sera alors accessible, une fois le package installé,
via :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="construire-un-package-r.html#cb2-1" aria-hidden="true" tabindex="-1"></a>?mypkgr</span></code></pre></div>
</div>
<div id="tester-le-package-de-manière-intéractive" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Tester le package de manière <em>intéractive</em><a href="construire-un-package-r.html#tester-le-package-de-manière-intéractive" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pour tester le package, vous devez le charger dans R à l’aide de :
dans l’onglet “Build”, le menu “More” puis “Load All” (ou Ctrl+Shift+L ou
<code>devtools::load_all()</code>).</p>
<p>Vous pouvez alors utiliser votre package directement dans R : consulter
l’aide de la fonction avec <code>?mvnpdf</code> et par exemple exécuter les commandes renseignées dans la section exemple de cette page d’aide.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="construire-un-package-r.html#cb3-1" aria-hidden="true" tabindex="-1"></a>?mvndpf</span></code></pre></div>
<p>Ainsi, lors du développement, vous pouvez :</p>
<ul>
<li><p>Ajouter/Modifier le code R</p></li>
<li><p>Re-charger le package Ctrl+Shift+L</p></li>
<li><p>Essayer dans la console</p></li>
<li><p>Et ainsi de suite…</p></li>
</ul>
</div>
<div id="tester-le-package-de-manière-automatique" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Tester le package de manière <em>automatique</em><a href="construire-un-package-r.html#tester-le-package-de-manière-automatique" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pour initialiser la fonctionnalité de tests automatiques dans le package,
utiliser :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="construire-un-package-r.html#cb4-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">use_testthat</span>()</span></code></pre></div>
<p>Cette commande induit la création d’un dossier <code>tests</code> qui comprend un
fichier <code>testthat.R</code> - à ne pas modifier - et un dossier <code>testthat</code> dans lequel on
va insérer nos tests. Cet outils s’appuie sur la théorie des <em>tests unitaires</em>.</p>
<p>Voici par exemple, le contenu d’un fichier qu’on appellera <code>test-univariate.R</code>
à mettre dans le dossier <code>testthat</code> :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="construire-un-package-r.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">context</span>(<span class="st">&quot;Univariate gaussian test&quot;</span>)</span>
<span id="cb5-2"><a href="construire-un-package-r.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="construire-un-package-r.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;correct result for univariate gaussian&quot;</span>, {</span>
<span id="cb5-4"><a href="construire-un-package-r.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mvnpdf</span>(<span class="at">x=</span><span class="fu">matrix</span>(<span class="fl">1.96</span>), <span class="at">Log=</span><span class="cn">FALSE</span>)<span class="sc">$</span>y, <span class="fu">dnorm</span>(<span class="fl">1.96</span>))</span>
<span id="cb5-5"><a href="construire-un-package-r.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mvnpdf</span>(<span class="at">x=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">1.96</span>, <span class="sc">-</span><span class="fl">0.5</span>), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="at">Log=</span><span class="cn">FALSE</span>)<span class="sc">$</span>y,</span>
<span id="cb5-6"><a href="construire-un-package-r.html#cb5-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">dnorm</span>(<span class="fu">c</span>(<span class="fl">1.96</span>, <span class="sc">-</span><span class="fl">0.5</span>)))</span>
<span id="cb5-7"><a href="construire-un-package-r.html#cb5-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Et un deuxième, appelé <code>test-bivariate.R</code> :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="construire-un-package-r.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">context</span>(<span class="st">&quot;Bivariate gaussian test&quot;</span>)</span>
<span id="cb6-2"><a href="construire-un-package-r.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="construire-un-package-r.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;correct results for bivariate gaussian&quot;</span>, {</span>
<span id="cb6-4"><a href="construire-un-package-r.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mvnpdf</span>(<span class="at">x=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">1.96</span>,<span class="dv">2</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">1</span>), <span class="at">Log=</span><span class="cn">FALSE</span>)<span class="sc">$</span>y,</span>
<span id="cb6-5"><a href="construire-un-package-r.html#cb6-5" aria-hidden="true" tabindex="-1"></a>               mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">rep</span>(<span class="fl">1.96</span>, <span class="dv">2</span>)))</span>
<span id="cb6-6"><a href="construire-un-package-r.html#cb6-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Pour exécuter ces tests, on peut utiliser dans l’onglet “Build”, le menu
“More”, “Test package” (ou <code>devtools::test()</code> ou Ctrl+Shift+T).</p>
<p>L’avantage de ces tests automatiques est qu’ils vont
s’exécuter à chaque fois qu’on effectuera un <em>check</em> du package.</p>
<p>Une bonne pratique est d’ajouter un test unitaire à chaque fois qu’un bug est identifier et résolu,
afin de pouvoir immédiatement identifier et prévenir qu’une erreur identique ne se reproduise dans
le futur.</p>
</div>
<div id="faire-un-check-du-package" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Faire un <em>check</em> du package<a href="construire-un-package-r.html#faire-un-check-du-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Faire un <em>check</em> signifie vérifier que tout est correct dans le package.
Il est <strong>nécessaire</strong> de “passer” le <em>check</em> pour pouvoir déposer le package
sur le CRAN.</p>
<p>Pour exécuter celui-ci, utiliser “Check” dans l’onglet “Build” (<code>devtools::check()</code> ou Ctrl+Shift+E).</p>
<p>Lors du <em>check</em>, les tests que nous avons mis au point précédemment sont
exécutées. C’est justement l’avantage d’avoir fait ces tests, nous n’avons
plus besoin de s’en préoccuper, mais juste de réagir en cas d’erreurs
renvoyées.</p>
</div>
<div id="installer-le-package" class="section level2 hasAnchor" number="1.7">
<h2><span class="header-section-number">1.7</span> Installer le package<a href="construire-un-package-r.html#installer-le-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pour le moment, le package n’existe que dans l’environnement associé au projet
Rstudio qu’on a créé. Pour pouvoir l’utiliser dans R de manière générale,
il faut l’installer (comme un package du CRAN par exemple).</p>
<p>Pour faire ça, utiliser “Install and Restart” dans l’onglet “Build” (<code>devtools::install()</code> ou Ctrl+Shift+B).</p>
<p>Et enfin, vous pouvez configurer le comportement de Rstudio pour qu’au moment
de l’installation, il documente en même temps le package : aller dans
l’onglet “Build”, le menu “More” puis “Configure Build Tools”. Cliquer ensuite
sur “Configure” puis cocher la case en bas “Install and Restart”.</p>
</div>
<div id="annexe-1.1-ajouter-une-méthode-s3" class="section level2 hasAnchor" number="1.8">
<h2><span class="header-section-number">1.8</span> Annexe 1.1 : ajouter une méthode S3<a href="construire-un-package-r.html#annexe-1.1-ajouter-une-méthode-s3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Dans la plupart des packages on est amenés à implémenter des méthodes S3,
très souvent pour qu’à partir d’un objet résultat <code>res</code>, on puisse exécuter
<code>print(res)</code>, <code>summary(res)</code>, <code>plot(res)</code>…</p>
<p>Voici un exemple de méthode <code>plot()</code> qu’on peut ajouter dans notre package :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="construire-un-package-r.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Plot of the mvnpdf function</span></span>
<span id="cb7-2"><a href="construire-un-package-r.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb7-3"><a href="construire-un-package-r.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x an object of class \code{mvnpdf} resulting from a call of</span></span>
<span id="cb7-4"><a href="construire-un-package-r.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \code{mnvpdf()} function.</span></span>
<span id="cb7-5"><a href="construire-un-package-r.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... graphical parameters passed to \code{plot()} function.</span></span>
<span id="cb7-6"><a href="construire-un-package-r.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb7-7"><a href="construire-un-package-r.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Nothing is returned, only a plot is given.</span></span>
<span id="cb7-8"><a href="construire-un-package-r.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb7-9"><a href="construire-un-package-r.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb7-10"><a href="construire-un-package-r.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb7-11"><a href="construire-un-package-r.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; pdfvalues &lt;- mvnpdf(x=matrix(seq(-3, 3, by = 0.1), nrow = 1), Log=FALSE)</span></span>
<span id="cb7-12"><a href="construire-un-package-r.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plot(pdfvalues)</span></span>
<span id="cb7-13"><a href="construire-un-package-r.html#cb7-13" aria-hidden="true" tabindex="-1"></a>plot.mvnpdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb7-14"><a href="construire-un-package-r.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x<span class="sc">$</span>x, x<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, ...)</span>
<span id="cb7-15"><a href="construire-un-package-r.html#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><em>Attention !</em> Pour que cette méthode fasse bien ce qu’on veut quand on
l’applique au résultat de notre fonction <code>mvnpdf()</code>, il faut déclarer que
ce résultat est de classe <code>mvnpdf</code>.</p>
<p>Tester cette fonction, en exécutant l’exemple.<br />
<em>N’oubliez pas de réinstaller le package (“Install and Restart” ou Ctrl+Shift+B).</em></p>
<p>Consulter le contenu du dossier <code>man</code> et les modifications qui ont été
apportées au fichier <code>NAMESPACE</code>.</p>
<p><em>Voici une proposition de solution</em> : le
<a href="https://r-dev-perf.borishejblum.science/FormationRavancee_dev_perf_files/mvnpdf.R">fichier</a>
contient le code complet
de la fonction <code>mvnpdf()</code> et de la méthode <code>plot()</code> associée.</p>
</div>
<div id="annexe-1.2-soumettre-son-package-au-cran" class="section level2 hasAnchor" number="1.9">
<h2><span class="header-section-number">1.9</span> Annexe 1.2 : soumettre son package au CRAN<a href="construire-un-package-r.html#annexe-1.2-soumettre-son-package-au-cran" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>devtools::check()</code> puis <code>devtools::submit_cran()</code></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="contrôle-de-version-avec-git-et-github-historique-de-changement-développement-collaboratif-et-intégration-continue.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sistm/OutilsDvpmtPerfR/blob/master/02-constr_package.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["FormationRavancee_dev_perf.pdf", "FormationRavancee_dev_perf.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
